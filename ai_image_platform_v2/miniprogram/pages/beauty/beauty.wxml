<!--pages/beauty/beauty.wxml-->
<view class="container">
  <!-- å›¾ç‰‡é¢„è§ˆåŒºåŸŸ -->
  <view class="preview-section">
    <view class="preview-card card">
      <view class="preview-container">
        <view wx:if="{{!currentImage}}" class="no-image">
          <view class="no-image-icon">ğŸ“·</view>
          <text class="no-image-text">è¯·å…ˆé€‰æ‹©å›¾ç‰‡</text>
          <button class="btn btn-primary" bindtap="chooseImage">é€‰æ‹©å›¾ç‰‡</button>
        </view>
        <view wx:else class="image-container">
          <!-- åŸå›¾/å¤„ç†åå¯¹æ¯” -->
          <view class="image-comparison" wx:if="{{processedImage}}">
            <view class="comparison-item {{activeView === 'original' ? 'active' : ''}}" bindtap="switchView" data-view="original">
              <image src="{{currentImage}}" class="comparison-image" mode="aspectFit"></image>
              <text class="comparison-label">åŸå›¾</text>
            </view>
            <view class="comparison-item {{activeView === 'processed' ? 'active' : ''}}" bindtap="switchView" data-view="processed">
              <image src="{{processedImage}}" class="comparison-image" mode="aspectFit"></image>
              <text class="comparison-label">å¤„ç†å</text>
            </view>
          </view>
          <!-- å•å›¾æ˜¾ç¤º -->
          <view wx:else class="single-image">
            <image src="{{currentImage}}" class="preview-image" mode="aspectFit"></image>
          </view>
          
          <!-- å›¾ç‰‡æ“ä½œæŒ‰é’® -->
          <view class="image-actions">
            <button class="action-btn" bindtap="chooseImage">
              <text class="action-icon">ğŸ”„</text>
              <text class="action-text">æ¢å›¾</text>
            </button>
            <button class="action-btn" bindtap="previewImage">
              <text class="action-icon">ğŸ”</text>
              <text class="action-text">é¢„è§ˆ</text>
            </button>
            <button class="action-btn" bindtap="saveImage" wx:if="{{processedImage}}">
              <text class="action-icon">ğŸ’¾</text>
              <text class="action-text">ä¿å­˜</text>
            </button>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç¾é¢œå·¥å…·åŒºåŸŸ -->
  <view class="tools-section" wx:if="{{currentImage}}">
    <view class="tools-card card">
      <view class="card-header">
        <text>ç¾é¢œå·¥å…·</text>
        <view class="header-actions">
          <button class="btn btn-outline" size="mini" bindtap="resetAll">é‡ç½®</button>
        </view>
      </view>
      <view class="card-body">
        <!-- å¿«é€Ÿç¾é¢œ -->
        <view class="quick-beauty">
          <text class="section-title">å¿«é€Ÿç¾é¢œ</text>
          <view class="quick-options">
            <button 
              class="quick-btn {{quickBeautyLevel === 'light' ? 'active' : ''}}" 
              bindtap="applyQuickBeauty" 
              data-level="light"
            >
              è½»åº¦
            </button>
            <button 
              class="quick-btn {{quickBeautyLevel === 'medium' ? 'active' : ''}}" 
              bindtap="applyQuickBeauty" 
              data-level="medium"
            >
              ä¸­åº¦
            </button>
            <button 
              class="quick-btn {{quickBeautyLevel === 'heavy' ? 'active' : ''}}" 
              bindtap="applyQuickBeauty" 
              data-level="heavy"
            >
              é‡åº¦
            </button>
          </view>
        </view>

        <!-- ç²¾ç»†è°ƒèŠ‚ -->
        <view class="fine-tuning">
          <text class="section-title">ç²¾ç»†è°ƒèŠ‚</text>
          
          <!-- ç£¨çš® -->
          <view class="adjustment-item">
            <view class="adjustment-header">
              <text class="adjustment-name">ç£¨çš®</text>
              <text class="adjustment-value">{{beautyParams.smooth}}</text>
            </view>
            <slider 
              class="adjustment-slider"
              min="0" 
              max="100" 
              value="{{beautyParams.smooth}}"
              bindchange="onSmoothChange"
              activeColor="#667eea"
              backgroundColor="#e9ecef"
            />
          </view>

          <!-- ç¾ç™½ -->
          <view class="adjustment-item">
            <view class="adjustment-header">
              <text class="adjustment-name">ç¾ç™½</text>
              <text class="adjustment-value">{{beautyParams.whiten}}</text>
            </view>
            <slider 
              class="adjustment-slider"
              min="0" 
              max="100" 
              value="{{beautyParams.whiten}}"
              bindchange="onWhitenChange"
              activeColor="#667eea"
              backgroundColor="#e9ecef"
            />
          </view>

          <!-- ç˜¦è„¸ -->
          <view class="adjustment-item">
            <view class="adjustment-header">
              <text class="adjustment-name">ç˜¦è„¸</text>
              <text class="adjustment-value">{{beautyParams.thinFace}}</text>
            </view>
            <slider 
              class="adjustment-slider"
              min="0" 
              max="100" 
              value="{{beautyParams.thinFace}}"
              bindchange="onThinFaceChange"
              activeColor="#667eea"
              backgroundColor="#e9ecef"
            />
          </view>

          <!-- å¤§çœ¼ -->
          <view class="adjustment-item">
            <view class="adjustment-header">
              <text class="adjustment-name">å¤§çœ¼</text>
              <text class="adjustment-value">{{beautyParams.bigEye}}</text>
            </view>
            <slider 
              class="adjustment-slider"
              min="0" 
              max="100" 
              value="{{beautyParams.bigEye}}"
              bindchange="onBigEyeChange"
              activeColor="#667eea"
              backgroundColor="#e9ecef"
            />
          </view>

          <!-- çº¢æ¶¦ -->
          <view class="adjustment-item">
            <view class="adjustment-header">
              <text class="adjustment-name">çº¢æ¶¦</text>
              <text class="adjustment-value">{{beautyParams.ruddy}}</text>
            </view>
            <slider 
              class="adjustment-slider"
              min="0" 
              max="100" 
              value="{{beautyParams.ruddy}}"
              bindchange="onRuddyChange"
              activeColor="#667eea"
              backgroundColor="#e9ecef"
            />
          </view>
        </view>

        <!-- åº”ç”¨æŒ‰é’® -->
        <view class="apply-section">
          <button 
            class="btn btn-primary btn-block {{processing ? 'btn-disabled' : ''}}" 
            bindtap="applyBeauty"
            disabled="{{processing}}"
          >
            <text wx:if="{{processing}}">å¤„ç†ä¸­...</text>
            <text wx:else>åº”ç”¨ç¾é¢œ</text>
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- AIå»ºè®®åŒºåŸŸ -->
  <view class="suggestions-section" wx:if="{{aiSuggestions.length > 0}}">
    <view class="suggestions-card card">
      <view class="card-header">
        <text>AIç¾é¢œå»ºè®®</text>
      </view>
      <view class="card-body">
        <view class="suggestions-list">
          <view 
            class="suggestion-item" 
            wx:for="{{aiSuggestions}}" 
            wx:key="id"
            bindtap="applySuggestion"
            data-suggestion="{{item}}"
          >
            <view class="suggestion-content">
              <text class="suggestion-title">{{item.title}}</text>
              <text class="suggestion-desc">{{item.description}}</text>
            </view>
            <view class="suggestion-action">
              <text class="action-text">åº”ç”¨</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>

<!-- åŠ è½½é®ç½© -->
<view class="loading-overlay" wx:if="{{processing}}">
  <view class="loading-content">
    <view class="loading-spinner"></view>
    <text class="loading-text">{{processingText}}</text>
  </view>
</view>