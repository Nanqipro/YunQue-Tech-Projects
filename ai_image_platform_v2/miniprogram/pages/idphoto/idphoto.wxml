<!--pages/idphoto/idphoto.wxml-->
<view class="container">
  <!-- å›¾ç‰‡é¢„è§ˆåŒºåŸŸ -->
  <view class="image-preview">
    <view wx:if="{{!currentImage}}" class="no-image">
      <view class="upload-icon">ğŸ“·</view>
      <text class="upload-text">é€‰æ‹©ç…§ç‰‡åˆ¶ä½œè¯ä»¶ç…§</text>
      <button class="upload-btn" bindtap="chooseImage">é€‰æ‹©ç…§ç‰‡</button>
    </view>
    
    <view wx:else class="image-container">
      <!-- å›¾ç‰‡å¯¹æ¯”è§†å›¾ -->
      <view wx:if="{{processedImage}}" class="image-compare">
        <view class="compare-item {{activeView === 'original' ? 'active' : ''}}" 
              bindtap="switchView" data-view="original">
          <image src="{{currentImage}}" mode="aspectFit" class="preview-image" />
          <text class="view-label">åŸå›¾</text>
        </view>
        <view class="compare-item {{activeView === 'processed' ? 'active' : ''}}" 
              bindtap="switchView" data-view="processed">
          <image src="{{processedImage}}" mode="aspectFit" class="preview-image" />
          <text class="view-label">è¯ä»¶ç…§</text>
        </view>
      </view>
      
      <!-- å•å›¾æ˜¾ç¤º -->
      <view wx:else class="single-image">
        <image src="{{currentImage}}" mode="aspectFit" class="preview-image" 
               bindtap="previewImage" />
      </view>
      
      <!-- å›¾ç‰‡æ“ä½œæŒ‰é’® -->
      <view class="image-actions">
        <button class="action-btn" bindtap="chooseImage">é‡æ–°é€‰æ‹©</button>
        <button class="action-btn" bindtap="previewImage">é¢„è§ˆ</button>
        <button wx:if="{{processedImage}}" class="action-btn primary" bindtap="saveImage">ä¿å­˜</button>
      </view>
    </view>
  </view>

  <!-- è¯ä»¶ç…§è§„æ ¼é€‰æ‹© -->
  <view class="spec-section">
    <view class="section-title">é€‰æ‹©è¯ä»¶ç…§è§„æ ¼</view>
    <scroll-view class="spec-list" scroll-x="true">
      <view wx:for="{{specList}}" wx:key="id" 
            class="spec-item {{selectedSpec.id === item.id ? 'active' : ''}}"
            bindtap="selectSpec" data-spec="{{item}}">
        <view class="spec-preview" style="width: {{item.width/10}}rpx; height: {{item.height/10}}rpx;">
          <text class="spec-ratio">{{item.width}}Ã—{{item.height}}</text>
        </view>
        <text class="spec-name">{{item.name}}</text>
        <text class="spec-size">{{item.width}}Ã—{{item.height}}åƒç´ </text>
      </view>
    </scroll-view>
  </view>

  <!-- èƒŒæ™¯é¢œè‰²é€‰æ‹© -->
  <view class="background-section">
    <view class="section-title">é€‰æ‹©èƒŒæ™¯é¢œè‰²</view>
    <view class="color-list">
      <view wx:for="{{backgroundColors}}" wx:key="name" 
            class="color-item {{selectedBackground === item.value ? 'active' : ''}}"
            bindtap="selectBackground" data-color="{{item.value}}">
        <view class="color-preview" style="background-color: {{item.value}};"></view>
        <text class="color-name">{{item.name}}</text>
      </view>
    </view>
  </view>

  <!-- é«˜çº§é€‰é¡¹ -->
  <view class="advanced-section">
    <view class="section-title">é«˜çº§é€‰é¡¹</view>
    <view class="option-list">
      <view class="option-item">
        <text class="option-label">ç¾é¢œå¤„ç†</text>
        <switch checked="{{enableBeauty}}" bindchange="toggleBeauty" />
      </view>
      <view class="option-item">
        <text class="option-label">è‡ªåŠ¨è£å‰ª</text>
        <switch checked="{{autoCrop}}" bindchange="toggleAutoCrop" />
      </view>
      <view class="option-item">
        <text class="option-label">æ™ºèƒ½æ¢è£…</text>
        <switch checked="{{smartDress}}" bindchange="toggleSmartDress" />
      </view>
    </view>
  </view>

  <!-- ç”ŸæˆæŒ‰é’® -->
  <view class="generate-section">
    <button class="generate-btn {{currentImage ? '' : 'disabled'}}" 
            bindtap="generateIdPhoto" disabled="{{!currentImage || processing}}">
      {{processing ? processingText : 'ç”Ÿæˆè¯ä»¶ç…§'}}
    </button>
  </view>

  <!-- AIå»ºè®®åŒºåŸŸ -->
  <view wx:if="{{aiSuggestions.length > 0}}" class="ai-suggestions">
    <view class="section-title">AIå»ºè®®</view>
    <view class="suggestion-list">
      <view wx:for="{{aiSuggestions}}" wx:key="index" class="suggestion-item"
            bindtap="applySuggestion" data-suggestion="{{item}}">
        <view class="suggestion-icon">ğŸ’¡</view>
        <view class="suggestion-content">
          <text class="suggestion-title">{{item.title}}</text>
          <text class="suggestion-desc">{{item.description}}</text>
        </view>
        <view class="suggestion-action">åº”ç”¨</view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½é®ç½© -->
  <view wx:if="{{processing}}" class="loading-mask">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text class="loading-text">{{processingText}}</text>
    </view>
  </view>
</view>