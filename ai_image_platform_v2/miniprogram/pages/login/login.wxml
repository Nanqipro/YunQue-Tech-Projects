<!--pages/login/login.wxml-->
<view class="container">
  <!-- å¤´éƒ¨LogoåŒºåŸŸ -->
  <view class="header-section">
    <view class="logo-container">
      <image src="../../images/logo.png" class="logo-image" mode="aspectFit"></image>
      <text class="app-title">AIå›¾åƒå¤„ç†</text>
      <text class="app-subtitle">è®©æ¯ä¸€å¼ ç…§ç‰‡éƒ½æ›´ç²¾å½©</text>
    </view>
  </view>

  <!-- ç™»å½•è¡¨å• -->
  <view class="form-section">
    <view class="form-card card">
      <view class="card-header">
        <text>{{isLoginMode ? 'ç™»å½•è´¦æˆ·' : 'æ³¨å†Œè´¦æˆ·'}}</text>
      </view>
      <view class="card-body">
        <form bindsubmit="handleSubmit">
          <!-- ç”¨æˆ·åè¾“å…¥ -->
          <view class="form-group">
            <label class="form-label">ç”¨æˆ·å</label>
            <input 
              class="form-input {{errors.username ? 'error' : ''}}" 
              type="text" 
              placeholder="è¯·è¾“å…¥ç”¨æˆ·å" 
              value="{{formData.username}}"
              bindinput="onUsernameInput"
              maxlength="20"
            />
            <text class="form-error" wx:if="{{errors.username}}">{{errors.username}}</text>
          </view>

          <!-- é‚®ç®±è¾“å…¥ï¼ˆæ³¨å†Œæ—¶æ˜¾ç¤ºï¼‰ -->
          <view class="form-group" wx:if="{{!isLoginMode}}">
            <label class="form-label">é‚®ç®±</label>
            <input 
              class="form-input {{errors.email ? 'error' : ''}}" 
              type="text" 
              placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€" 
              value="{{formData.email}}"
              bindinput="onEmailInput"
            />
            <text class="form-error" wx:if="{{errors.email}}">{{errors.email}}</text>
          </view>

          <!-- å¯†ç è¾“å…¥ -->
          <view class="form-group">
            <label class="form-label">å¯†ç </label>
            <view class="password-input-container">
              <input 
                class="form-input password-input {{errors.password ? 'error' : ''}}" 
                type="{{showPassword ? 'text' : 'password'}}" 
                placeholder="è¯·è¾“å…¥å¯†ç " 
                value="{{formData.password}}"
                bindinput="onPasswordInput"
                maxlength="50"
              />
              <view class="password-toggle" bindtap="togglePassword">
                <text class="toggle-icon">{{showPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸'}}</text>
              </view>
            </view>
            <text class="form-error" wx:if="{{errors.password}}">{{errors.password}}</text>
          </view>

          <!-- ç¡®è®¤å¯†ç ï¼ˆæ³¨å†Œæ—¶æ˜¾ç¤ºï¼‰ -->
          <view class="form-group" wx:if="{{!isLoginMode}}">
            <label class="form-label">ç¡®è®¤å¯†ç </label>
            <input 
              class="form-input {{errors.confirmPassword ? 'error' : ''}}" 
              type="password" 
              placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç " 
              value="{{formData.confirmPassword}}"
              bindinput="onConfirmPasswordInput"
              maxlength="50"
            />
            <text class="form-error" wx:if="{{errors.confirmPassword}}">{{errors.confirmPassword}}</text>
          </view>

          <!-- æäº¤æŒ‰é’® -->
          <button 
            class="btn btn-primary btn-block {{loading ? 'btn-disabled' : ''}}" 
            form-type="submit"
            disabled="{{loading}}"
          >
            <text wx:if="{{loading}}">{{loadingText}}</text>
            <text wx:else>{{isLoginMode ? 'ç™»å½•' : 'æ³¨å†Œ'}}</text>
          </button>
        </form>

        <!-- åˆ‡æ¢ç™»å½•/æ³¨å†Œæ¨¡å¼ -->
        <view class="mode-switch">
          <text class="switch-text">
            {{isLoginMode ? 'è¿˜æ²¡æœ‰è´¦æˆ·ï¼Ÿ' : 'å·²æœ‰è´¦æˆ·ï¼Ÿ'}}
          </text>
          <text class="switch-link" bindtap="switchMode">
            {{isLoginMode ? 'ç«‹å³æ³¨å†Œ' : 'ç«‹å³ç™»å½•'}}
          </text>
        </view>

        <!-- å¿«é€Ÿç™»å½•é€‰é¡¹ -->
        <view class="quick-login" wx:if="{{isLoginMode}}">
          <view class="divider-container">
            <view class="divider-line"></view>
            <text class="divider-text">æˆ–</text>
            <view class="divider-line"></view>
          </view>
          
          <view class="quick-options">
            <button class="btn btn-outline btn-block" bindtap="guestLogin">
              <text>æ¸¸å®¢ä½“éªŒ</text>
            </button>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æœåŠ¡æ¡æ¬¾ -->
  <view class="terms-section" wx:if="{{!isLoginMode}}">
    <view class="terms-container">
      <label class="checkbox-container">
        <checkbox value="agree" checked="{{agreedToTerms}}" bindchange="onTermsChange"/>
        <text class="checkbox-text">æˆ‘å·²é˜…è¯»å¹¶åŒæ„</text>
      </label>
      <text class="terms-link" bindtap="showTerms">ã€ŠæœåŠ¡æ¡æ¬¾ã€‹</text>
      <text class="checkbox-text">å’Œ</text>
      <text class="terms-link" bindtap="showPrivacy">ã€Šéšç§æ”¿ç­–ã€‹</text>
    </view>
  </view>
</view>

<!-- åŠ è½½é®ç½© -->
<view class="loading-overlay" wx:if="{{loading}}">
  <view class="loading-content">
    <view class="loading-spinner"></view>
    <text class="loading-text">{{loadingText}}</text>
  </view>
</view>